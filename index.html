<!DOCTYPE html>
<html>
<head>
    <title>–°–Ω—è—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ –ü–µ–Ω–∑–µ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimum-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
	<script src="https://api-maps.yandex.ru/2.1/?apikey=64aee918-edb7-404b-ae99-c3d58f6eb4de&lang=ru_RU" type="text/javascript"></script>
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f9f9f9;
            min-height: 100vh;
            min-width: 320px;
            font-size: 16px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
        }

        h1 {
            margin: 10px 0;
            font-size: 28px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: #333;
            text-align: center;
        }

        .filter-section {
            width: 90%;
            max-width: 400px;
            background-color: white;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 8px;
        }

        .filter-section h2 {
            font-size: 18px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: #333;
            margin-bottom: 8px;
        }

        .filter-section .subtitle {
            font-style: italic;
            font-size: 14px;
            color: #707070;
            margin-bottom: 8px;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }

        .filter-buttons button {
            flex: 1 1 calc(50% - 8px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: white;
            color: #333;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
            font-size: 16px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
        }

        .filter-buttons button.active {
            background-color: #0078A8;
            color: white;
            border-color: #0078A8;
        }

        .price-inputs {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 8px;
        }

        .price-inputs input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            text-align: center;
            width: 100px;
        }

        .price-inputs input:focus {
            outline: none;
            border-color: #0078A8;
        }

        .price-inputs span {
            font-size: 16px;
            color: #333;
        }

        .link-button {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f3f4f6;
            color: #333;
            cursor: pointer;
            font-size: 16px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
            margin-bottom: 8px;
        }

        .link-button.disabled {
            background-color: #f3f4f6;
            color: #a0a0a0;
            cursor: not-allowed;
        }

        .link-button .arrow {
            font-size: 16px;
            color: #707070;
        }
        
		.save-button {
            width: 90%;
            max-width: 400px;
            padding: 12px;
            border: none;
            border-radius: 5px;
            background-color: #0078A8;
            color: white;
            font-size: 18px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            cursor: pointer;
        }

        .save-button:hover {
            background-color: #005f87;
        }

        .district-selector {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .district-selector h2 {
            font-size: 24px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: #333;
            margin-bottom: 20px;
        }

        .district-selector .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: #333;
            cursor: pointer;
        }

        .district-selector .filter-buttons {
            margin-bottom: 20px;
        }

        .district-selector .filter-buttons button {
            width: 100%;
            margin-bottom: 10px;
        }

        .district-selector .finish-button {
            display: block;
            width: fit-content;
            margin: 20px auto 0;
            padding: 10px 16px;
            border: none;
            border-radius: 5px;
            background-color: #0078A8;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        .selected-districts {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
            margin-bottom: 8px;
        }

        .selected-districts .district {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            background-color: #f3f4f6;
            border-radius: 20px;
            font-size: 16px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: #333;
        }

        .selected-districts .district .remove {
            margin-left: 8px;
            cursor: pointer;
            color: #707070;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç—ã */
        .microdistrict-selector {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
            padding: 0;
            box-sizing: border-box;
            overflow-y: auto;
        }

        #map {
            height: 100vh; /* –í—ã—Å–æ—Ç–∞ –∫–∞—Ä—Ç—ã –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
            width: 100%;   /* –®–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç—ã –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ */
        .button-container {
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        #selectButton, #clearMapButton {
            padding: 10px 20px;
            background-color: white;
            color: #707070;
            border: 2px solid #707070;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }

        #selectButton:disabled {
            background-color: #f3f4f6;
            color: #a0a0a0;
            cursor: not-allowed;
            border-color: #ccc;
        }

        #selectButton.active, #clearMapButton:hover {
            background-color: #0078A8;
            color: white;
            border-color: #0078A8;
        }

        /* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */
        #exitButton {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid #707070;
            color: #707070;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

		/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ */
		.filter-actions {
			width: 90%;
			max-width: 400px;
			display: flex;
			justify-content: space-between;
			gap: 10px; /* –û—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏ */
			margin-top: 10px;
			margin-bottom: 20px;
		}
		
		/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä" */
		.save-button {
			flex: 1;
			padding: 12px;
			border: none;
			border-radius: 5px;
			background-color: #0078A8;
			color: white;
			font-size: 18px;
			cursor: pointer;
			transition: background-color 0.3s;
		}
		
		.save-button:hover {
			background-color: #005f87;
		}
		
		/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë" */
		.reset-all-button {
			flex: 1;
			padding: 12px;
			border: 1px solid #ccc;;
			border-radius: 5px;
			background-color: #f3f4f6;
			color: #333;
			font-size: 18px;
			cursor: pointer;
			transition: background-color 0.3s;
		}
		
		.reset-all-button:disabled {
			background-color: #f3f4f6;
			color: #a0a0a0;
			cursor: not-allowed;
		}
		
		.reset-all-button:not(:disabled):hover {
			background-color: #e0e0e0;
		}
		
		/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å" –†–∞–π–æ–Ω—ã*/
		.reset-button {
			width: auto;
			padding: 10px 20px;
			border: none;
			border-radius: 25px;
			background-color: #f3f4f6;
			color: #333;
			cursor: pointer;
			font-size: 16px;
			text-align: center;
			transition: background-color 0.3s;
		}
		
		.reset-button:hover {
			background-color: #e0e0e0;
		}

        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .confirmation-modal .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .confirmation-modal .modal-content button {
            margin: 10px;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .confirmation-modal .modal-content button.confirm {
            background-color: #0078A8;
            color: white;
        }

        .confirmation-modal .modal-content button.cancel {
            background-color: #f3f4f6;
            color: #333;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–π—Ç–∏" */
        .search-container {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
			display: flex;
            align-items: center;
            background-color: white;
            border-radius: 25px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            padding: 5px;
        }

        #searchInput {
            flex: 1;
            padding: 10px;
			width: 150px; /* –ù–æ–≤–∞—è —à–∏—Ä–∏–Ω–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞ */
            border: none;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
        }

        .search-divider {
            width: 1px;
            height: 24px;
            background-color: #ccc;
            margin: 0 10px;
        }

        #searchButton {
            padding: 8px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #searchButton svg {
            width: 24px;
            height: 24px;
        }

        #searchButton:hover svg path {
            fill: #0078A8;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–π—Ç–∏ –º–µ–Ω—è" */
        #locateButton {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            z-index: 1000;
            padding: 10px;
            background-color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        #locateButton svg {
            width: 24px;
            height: 24px;
        }

        #locateButton:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>–°–Ω—è—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É –≤ –ü–µ–Ω–∑–µ</h1>

    <!-- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∂–∏–ª—å—è -->
    <div class="filter-section" id="roomCountSection">
        <h2>–¢–∏–ø –∂–∏–ª—å—è</h2>
        <div class="filter-buttons" id="roomCountButtons">
            <button data-count="–û–ö">–ö–æ–º–Ω–∞—Ç–∞ —Å –û–ö</button>
            <button data-count="–°—Ç—É–¥–∏—è">–°—Ç—É–¥–∏—è</button>
            <button data-count="1">1-–∫–æ–º.</button>
            <button data-count="2">2-–∫–æ–º.</button>
            <button data-count="3">3-–∫–æ–º.</button>
            <button data-count="4">4+ –∫–æ–º.</button>
        </div>
    </div>

    <!-- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ —Ü–µ–Ω—ã -->
    <div class="filter-section">
        <h2>–°—Ç–æ–∏–º–æ—Å—Ç—å, ‚ÇΩ/–º–µ—Å.</h2>
        <div class="price-inputs">
            <input type="text" id="minPrice" placeholder="–û—Ç 4000" oninput="validatePriceInput(this)" onblur="validatePriceOnBlur(this)">
            <span>-</span>
            <input type="text" id="maxPrice" placeholder="–î–æ" oninput="validatePriceInput(this)" onblur="validatePriceOnBlur(this)">
        </div>
    </div>

    <!-- –í –æ—Å–Ω–æ–≤–Ω–æ–º –æ–∫–Ω–µ –≤—ã–±–æ—Ä–∞ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤ -->
    <div class="filter-section">
        <h2>–†–∞–π–æ–Ω—ã</h2>
        <div class="subtitle">üõà –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –†–∞–π–æ–Ω–æ–≤ –≤—ã–±–æ—Ä –ú–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–∞ –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>
        <button class="link-button" id="districtButton" onclick="openDistrictSelector()">
            –í—ã–±–æ—Ä —Ä–∞–π–æ–Ω–æ–≤
            <span class="arrow">| ></span>
        </button>
        <div class="selected-districts" id="selectedDistricts"></div>
        <button class="link-button" id="microDistrictButton" onclick="openMicroDistrictSelector()">
            –í—ã–±–æ—Ä –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤
            <span class="arrow">| ></span>
        </button>
        <div class="selected-districts" id="selectedMicroDistricts"></div>
        <!-- –ö–Ω–æ–ø–∫–∞ "–°–±—Ä–æ—Å–∏—Ç—å" –≤ –±–ª–æ–∫–µ "–†–∞–π–æ–Ω—ã" -->
		<button id="clearMainButton" class="reset-button" onclick="clearDistricts()">–°–±—Ä–æ—Å–∏—Ç—å</button>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ "–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã" —Ä—è–¥–æ–º —Å "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã" -->
	<div class="filter-actions">
		<button class="save-button" onclick="handleSaveButtonClick()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä</button>
		<button class="reset-all-button" onclick="clearAllFilters()" disabled>–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
	</div>

    <!-- –ë–ª–æ–∫ –≤—ã–±–æ—Ä–∞ —Ä–∞–π–æ–Ω–æ–≤ -->
    <div class="district-selector" id="districtSelector">
        <div class="close-button" onclick="closeDistrictSelector()">√ó</div>
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω—ã</h2>
        <div class="filter-buttons">
            <button data-district="all">–í—Å—è –ü–µ–Ω–∑–∞</button>
            <button data-district="–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π">–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π</button>
            <button data-district="–õ–µ–Ω–∏–Ω—Å–∫–∏–π">–õ–µ–Ω–∏–Ω—Å–∫–∏–π</button>
            <button data-district="–ü–µ—Ä–≤–æ–º–∞–π—Å–∫–∏–π">–ü–µ—Ä–≤–æ–º–∞–π—Å–∫–∏–π</button>
            <button data-district="–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π">–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π</button>
            <button data-district="–ó–∞—Å–µ—á–Ω–æ–µ">–ó–∞—Å–µ—á–Ω–æ–µ</button>
            <button data-district="–£—Ö—Ç–∏–Ω–∫–∞">–£—Ö—Ç–∏–Ω–∫–∞</button>
            <button data-district="–ë–æ–≥–æ—Å–ª–æ–≤–∫–∞">–ë–æ–≥–æ—Å–ª–æ–≤–∫–∞</button>
            <button data-district="–ë–µ—Å—Å–æ–Ω–æ–≤–∫–∞">–ë–µ—Å—Å–æ–Ω–æ–≤–∫–∞</button>
            <button data-district="–ß–µ–º–æ–¥–∞–Ω–æ–≤–∫–∞">–ß–µ–º–æ–¥–∞–Ω–æ–≤–∫–∞</button>
        </div>
        <button class="finish-button" onclick="closeDistrictSelector()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–±–æ—Ä</button>
    </div>

    <!-- –í –±–ª–æ–∫–µ –≤—ã–±–æ—Ä–∞ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ -->
    <div class="microdistrict-selector" id="microdistrictSelector" style="display: none;">
		<!-- –ö–∞—Ä—Ç–∞ -->
        <div id="map"></div>
        <!-- –ü–æ–∏—Å–∫ –∏ –∫–Ω–æ–ø–∫–∞ "–ù–∞–π—Ç–∏" -->
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å (—É–ª–∏—Ü–∞, –¥–æ–º)">
            <div class="search-divider"></div>
            <button id="searchButton" onclick="searchAddress()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 2C5.58172 2 2 5.58172 2 10C2 14.4183 5.58172 18 10 18C12.125 18 14.078 17.2635 15.617 16.0319L20.2929 20.7071C20.6834 21.0976 21.3166 21.0976 21.7071 20.7071C22.0976 20.3166 22.0976 19.6834 21.7071 19.2929L17.0319 14.617C18.2635 13.078 19 11.125 19 10C19 5.58172 15.4183 2 10 2ZM10 4C14.4183 4 18 7.58172 18 12C18 16.4183 14.4183 20 10 20C5.58172 20 2 16.4183 2 12C2 7.58172 5.58172 4 10 4Z" fill="#707070"/>
                </svg>
            </button>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–π—Ç–∏ –º–µ–Ω—è" -->
        <div id="locateButton" onclick="locateUser()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C12.5128 2 12.9355 2.38604 12.9933 2.88338L13 3L13.0003 4.31397C16.4809 4.7625 19.2381 7.51999 19.6862 11.0007L21 11C21.5523 11 22 11.4477 22 12C22 12.5128 21.614 12.9355 21.1166 12.9933L21 13L19.686 13.0003C19.2375 16.4805 16.4805 19.2375 13.0003 19.686L13 21C13 21.5523 12.5523 22 12 22C11.4872 22 11.0645 21.614 11.0067 21.1166L11 21L11.0007 19.6862C7.51999 19.2381 4.7625 16.4809 4.31397 13.0003L3 13C2.44772 13 2 12.5523 2 12C2 11.4872 2.38604 11.0645 2.88338 11.0067L3 11L4.31384 11.0007C4.76197 7.51965 7.51965 4.76197 11.0007 4.31384L11 3C11 2.44772 11.4477 2 12 2ZM12 6.25C8.82436 6.25 6.25 8.82436 6.25 12C6.25 15.1756 8.82436 17.75 12 17.75C15.1756 17.75 17.75 15.1756 17.75 12C17.75 8.82436 15.1756 6.25 12 6.25ZM12 8C14.2091 8 16 9.79086 16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79086 9.79086 8 12 8Z" fill="#212121"/>
            </svg>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ -->
        <div class="button-container">
            <button id="selectButton" disabled>–í—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω</button>
            <button id="clearMapButton">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        <button id="exitButton" onclick="closeMicroDistrictSelector()">√ó</button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞ -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="modal-content">
            <p>–§–∏–ª—å—Ç—Ä—ã –Ω–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?</p>
            <button class="confirm" onclick="confirmExit()">–î–∞</button>
            <button class="cancel" onclick="cancelExit()">–ù–µ—Ç</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
		const WebApp = window.Telegram.WebApp;
		
		function getSelectedFiltersMessage() {
			const selectedRoomCounts = Array.from(document.querySelectorAll('#roomCountButtons .active'))
				.map(btn => btn.dataset.count)
				.join(', ');
		
			const minPrice = document.getElementById('minPrice').value;
			const maxPrice = document.getElementById('maxPrice').value;
		
			const selectedDistricts = Array.from(document.querySelectorAll('.district-selector .filter-buttons button.active'))
				.map(button => button.dataset.district)
				.filter(district => district !== 'all')
				.join(', ');
		
			const selectedMicroDistricts = JSON.parse(localStorage.getItem('selectedMicroDistricts')) || [];
		
			let message = '–í—ã –≤—ã–±—Ä–∞–ª–∏ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã:\n\n';
			message += `- –¢–∏–ø –∂–∏–ª—å—è: ${selectedRoomCounts || '–Ω–µ –≤—ã–±—Ä–∞–Ω–æ'}\n`;
			message += `- –¶–µ–Ω–∞: –æ—Ç ${minPrice || '0'} –¥–æ ${maxPrice || '‚àû'}\n`;
			message += `- –†–∞–π–æ–Ω—ã: ${selectedDistricts || '–Ω–µ –≤—ã–±—Ä–∞–Ω–æ'}\n`;
			message += `- –ú–∏–∫—Ä–æ—Ä–∞–π–æ–Ω—ã: ${selectedMicroDistricts.join(', ') || '–Ω–µ –≤—ã–±—Ä–∞–Ω–æ'}\n\n`;
			message += '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã?';
		
			return message;
		}
		
		function showSaveConfirmation() {
			const message = getSelectedFiltersMessage();
		
			WebApp.showConfirm(message, (isConfirmed) => {
				if (isConfirmed) {
					// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–î–∞, —Ç–æ —á—Ç–æ –Ω—É–∂–Ω–æ!"
					saveFilter();
				} else {
					// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã"
					console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ—à–∏–ª –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.');
				}
			});
		}
		// –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
		document.addEventListener('DOMContentLoaded', () => {
			restoreFilters(); // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
		});
	
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
		function restoreFilters() {
			// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
			updateSelectedMicroDistricts();
		
			// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞–π–æ–Ω–æ–≤
			const selectedDistricts = JSON.parse(localStorage.getItem('selectedDistricts')) || [];
			if (selectedDistricts.length > 0) {
				selectedDistricts.forEach(district => {
					const button = document.querySelector(`button[data-district="${district}"]`);
					if (button) {
						button.classList.add('active');
					}
				});
				updateSelectedDistricts();
			}
		
			// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã
			const minPrice = localStorage.getItem('minPrice');
			const maxPrice = localStorage.getItem('maxPrice');
			if (minPrice) {
				document.getElementById('minPrice').value = minPrice;
			}
			if (maxPrice) {
				document.getElementById('maxPrice').value = maxPrice;
			}
		
			// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∂–∏–ª—å—è
			const selectedRoomCounts = JSON.parse(localStorage.getItem('selectedRoomCounts')) || [];
			selectedRoomCounts.forEach(count => {
				const button = document.querySelector(`button[data-count="${count}"]`);
				if (button) {
					button.classList.add('active');
				}
			});
		
			// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
			checkFilters();
			updateResetButton(); // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ "–°–±—Ä–æ—Å–∏—Ç—å" –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–∞–π–æ–Ω–æ–≤/–º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤
		}
		
		<!-- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ -->
		function restoreMicroDistrictsOnMap() {
			const selectedMicroDistricts = JSON.parse(localStorage.getItem('selectedMicroDistricts')) || [];
			if (selectedMicroDistricts.length > 0 && geojsonLayer) {
				selectedMicroDistricts.forEach(microDistrict => {
					const layer = geojsonLayer.getLayers().find(l => l.feature.properties.Name === microDistrict);
					if (layer) {
						layer.setStyle({
							color: 'red',
							fillColor: 'red',
							fillOpacity: 0.2
						});
						selectedPolygons[microDistrict] = layer;
					}
				});
				updateSelectButtonState();
			}
		}
		
		
		<!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–π–æ–Ω—ã -->
        const mainDistricts = ['–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π', '–õ–µ–Ω–∏–Ω—Å–∫–∏–π', '–ü–µ—Ä–≤–æ–º–∞–π—Å–∫–∏–π', '–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π'];
        const allDistricts = [...mainDistricts, '–ó–∞—Å–µ—á–Ω–æ–µ', '–£—Ö—Ç–∏–Ω–∫–∞', '–ë–æ–≥–æ—Å–ª–æ–≤–∫–∞', '–ë–µ—Å—Å–æ–Ω–æ–≤–∫–∞', '–ß–µ–º–æ–¥–∞–Ω–æ–≤–∫–∞'];

        <!-- –õ–æ–≥–∏–∫–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –∂–∏–ª—å—è -->
        const roomCountButtons = document.querySelectorAll('#roomCountButtons button');
        roomCountButtons.forEach(button => {
            button.addEventListener('click', () => {
                button.classList.toggle('active');
            });
        });
		
		// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∂–∏–ª—å—è
		function saveRoomCounts() {
			const selectedRoomCounts = Array.from(document.querySelectorAll('#roomCountButtons .active'))
				.map(btn => btn.dataset.count);
			localStorage.setItem('selectedRoomCounts', JSON.stringify(selectedRoomCounts));
		}

        <!-- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞ —Ü–µ–Ω—ã (–æ—á–∏—Å—Ç–∫–∞ –æ—Ç –Ω–µ—á–∏—Å–ª–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤) -->
        function validatePriceInput(input) {
            input.value = input.value.replace(/\D/g, '');
        }

        <!-- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ -->
        function validatePriceOnBlur(input) {
            const minPriceInput = document.getElementById('minPrice');
            const maxPriceInput = document.getElementById('maxPrice');

            <!-- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ —á–∏—Å–ª–∞ -->
            const minPrice = parseInt(minPriceInput.value, 10) || 0;
            const maxPrice = parseInt(maxPriceInput.value, 10) || 0;

            if (input === minPriceInput) {
                // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 4000
                if (minPrice < 4000) {
                    minPriceInput.value = 4000;
                    WebApp.showAlert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 4000 —Ä—É–±–ª–µ–π.');
                }
            }

            if (input === maxPriceInput && minPriceInput.value) {
                // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 4000
                if (maxPrice < 4000) {
                    maxPriceInput.value = 4000;
                    WebApp.showAlert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 4000 —Ä—É–±–ª–µ–π.');
                }

                // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π
                if (maxPrice < minPrice) {
                    maxPriceInput.value = minPrice;
                    WebApp.showAlert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π.');
                }
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ñ–∏–ª—å—Ç—Ä–∞
        function validatePriceBeforeSave() {
            const minPriceInput = document.getElementById('minPrice');
            const maxPriceInput = document.getElementById('maxPrice');

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ —á–∏—Å–ª–∞
            const minPrice = parseInt(minPriceInput.value, 10) || 0;
            const maxPrice = parseInt(maxPriceInput.value, 10) || 0;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã
            if (!minPriceInput.value.trim()) {
                WebApp.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É.');
                minPriceInput.focus(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ
                return false; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            }

            if (minPrice < 4000) {
                WebApp.showAlert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 4000 —Ä—É–±–ª–µ–π.');
                minPriceInput.focus(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ
                return false; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã
            if (!maxPriceInput.value.trim()) {
                WebApp.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É.');
                maxPriceInput.focus(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ
                return false; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            }

            if (maxPrice < minPrice) {
                WebApp.showAlert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π.');
                maxPriceInput.focus(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ
                return false; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            }

            return true; // –¶–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞, –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
        }
		
		// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã
		function savePrice() {
			const minPrice = document.getElementById('minPrice').value;
			const maxPrice = document.getElementById('maxPrice').value;
			localStorage.setItem('minPrice', minPrice);
			localStorage.setItem('maxPrice', maxPrice);
		}

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –±–ª–æ–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–∞–π–æ–Ω–æ–≤
        function openDistrictSelector() {
            document.getElementById('districtSelector').style.display = 'block';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –±–ª–æ–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–∞–π–æ–Ω–æ–≤
        function closeDistrictSelector() {
            document.getElementById('districtSelector').style.display = 'none';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞–π–æ–Ω–æ–≤
        function updateSelectedDistricts() {
			const selectedDistricts = [];
			allDistricts.forEach(district => {
				const button = document.querySelector(`button[data-district="${district}"]`);
				if (button.classList.contains('active')) {
					selectedDistricts.push(district);
				}
			});
		
			const allButton = document.querySelector('button[data-district="all"]');
			const isAllSelected = mainDistricts.every(district =>
				document.querySelector(`button[data-district="${district}"]`).classList.contains('active')
			);
			allButton.classList.toggle('active', isAllSelected);
		
			const selectedDistrictsContainer = document.getElementById('selectedDistricts');
			selectedDistrictsContainer.innerHTML = selectedDistricts
				.map(district => `
					<div class="district">
						${district}
						<span class="remove" onclick="removeDistrict('${district}')">| √ó</span>
					</div>
				`)
				.join('');
		
			const microDistrictButton = document.getElementById('microDistrictButton');
			if (selectedDistricts.length > 0) {
				microDistrictButton.classList.add('disabled');
				microDistrictButton.disabled = true;
			} else {
				microDistrictButton.classList.remove('disabled');
				microDistrictButton.disabled = false;
			}
		
			updateResetButton();
		}

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ä–∞–π–æ–Ω–∞
        function removeDistrict(district) {
            const button = document.querySelector(`button[data-district="${district}"]`);
            button.classList.remove('active');
            updateSelectedDistricts();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–∞–π–æ–Ω–æ–≤
        const districtButtons = document.querySelectorAll('.district-selector .filter-buttons button');
        districtButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (button.dataset.district === 'all') {
                    // –í—ã–±–æ—Ä/—Å–Ω—è—Ç–∏–µ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–∞–π–æ–Ω–æ–≤
                    const isAllSelected = button.classList.contains('active');
                    mainDistricts.forEach(district => {
                        const districtButton = document.querySelector(`button[data-district="${district}"]`);
                        districtButton.classList.toggle('active', !isAllSelected);
                    });
                } else {
                    // –í—ã–±–æ—Ä/—Å–Ω—è—Ç–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–∞–π–æ–Ω–∞
                    button.classList.toggle('active');
                }
                updateSelectedDistricts();
            });
        });
		
		// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞–π–æ–Ω–æ–≤
		function saveDistricts() {
			const selectedDistricts = Array.from(document.querySelectorAll('.district-selector .filter-buttons button.active'))
				.map(button => button.dataset.district)
				.filter(district => district !== 'all');
			localStorage.setItem('selectedDistricts', JSON.stringify(selectedDistricts));
		}

        // –õ–æ–≥–∏–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å"
        function clearDistricts() {
            // –û—á–∏—â–∞–µ–º –≤—ã–±–æ—Ä —Ä–∞–π–æ–Ω–æ–≤
            const districtButtons = document.querySelectorAll('.district-selector .filter-buttons button.active');
            districtButtons.forEach(button => button.classList.remove('active'));
            updateSelectedDistricts();

            // –û—á–∏—â–∞–µ–º –≤—ã–±–æ—Ä –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤
            localStorage.removeItem('selectedMicroDistricts');
            updateSelectedMicroDistricts();

            // –û—á–∏—â–∞–µ–º –∫–∞—Ä—Ç—É
            if (geojsonLayer) {
                geojsonLayer.eachLayer(layer => {
                    layer.setStyle(defaultStyle);
                });
            }
            selectedPolygons = {};

            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É "–í—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω" –Ω–∞ –∫–∞—Ä—Ç–µ –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            const selectButton = document.getElementById('selectButton');
            selectButton.disabled = true;
            selectButton.classList.remove('active');
            selectButton.textContent = "–í—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω";
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å" –±–ª–æ–∫ "–†–∞–π–æ–Ω—ã"
        function updateResetButton() {
			const clearMainButton = document.getElementById('clearMainButton');
			const selectedDistricts = document.querySelectorAll('.district-selector .filter-buttons button.active').length > 0;
			const selectedMicroDistricts = JSON.parse(localStorage.getItem('selectedMicroDistricts')) || [];
		
			if (selectedDistricts || selectedMicroDistricts.length > 0) {
				clearMainButton.style.display = 'block';
			} else {
				clearMainButton.style.display = 'none';
			}
		}

        // –õ–æ–≥–∏–∫–∞ –¥–ª—è –∫–∞—Ä—Ç—ã
		let map;
		let marker = null;
        var geojsonLayer;
        var selectedPolygons = {};
        var defaultStyle = {
            color: '#3388ff',
            fillColor: '#3388ff',
            fillOpacity: 0.2
        };

        function loadGeoJSONData() {
			if (map) {
				map.setView([53.2, 45.0], 11);
				return;
			}
		
			map = L.map('map').setView([53.2, 45.0], 11);
			L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '¬© OpenStreetMap contributors'
			}).addTo(map);
		
			var highlightStyle = {
				color: 'red',
				fillColor: 'red',
				fillOpacity: 0.2
			};
		
			function onEachFeature(feature, layer) {
				if (feature.properties && feature.properties.Name) {
					layer.bindPopup(feature.properties.Name);
					layer.on('click', function(e) {
						var featureId = feature.properties.Name;
		
						if (selectedPolygons[featureId]) {
							layer.setStyle(defaultStyle);
							delete selectedPolygons[featureId];
						} else {
							layer.setStyle(highlightStyle);
							selectedPolygons[featureId] = layer;
						}
		
						updateSelectButtonState();
					});
				}
			}

            // –ó–∞–≥—Ä—É–∂–∞–µ–º GeoJSON —Ñ–∞–π–ª
			fetch('map.geojson')
				.then(response => response.json())
				.then(data => {
					geojsonData = data; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
					
					geojsonLayer = L.geoJSON(data, {
						style: defaultStyle,
						onEachFeature: onEachFeature
					}).addTo(map);
					
					// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
					restoreMicroDistrictsOnMap();
				})
				.catch(error => {
					console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ GeoJSON:', error);
					WebApp.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤');
				});

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–±–æ—Ä"
            var selectButton = document.getElementById('selectButton');
            selectButton.addEventListener('click', function() {
                const selectedMicroDistricts = Object.keys(selectedPolygons);
                localStorage.setItem('selectedMicroDistricts', JSON.stringify(selectedMicroDistricts));
                closeMicroDistrictSelector();
                updateSelectedMicroDistricts();
                updateResetButton();
            });

           // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û—á–∏—Å—Ç–∏—Ç—å" –Ω–∞ –∫–∞—Ä—Ç–µ
			var clearMapButton = document.getElementById('clearMapButton');
			clearMapButton.addEventListener('click', function () {
				// –û—á–∏—â–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª–∏–≥–æ–Ω—ã
				selectedPolygons = {};
				geojsonLayer.eachLayer(layer => {
					layer.setStyle(defaultStyle);
				});
			
				// –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ–∏—Å–∫–∞
				document.getElementById('searchInput').value = '';
			
				// –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
				if (marker) {
					map.removeLayer(marker);
					marker = null;
				}
			
				// –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
				map.setView([53.2, 45.0], 11); // –ù–∞—á–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏ —É—Ä–æ–≤–µ–Ω—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
			
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–í—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω"
				updateSelectButtonState();
			
				// –û—á–∏—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω—ã
				localStorage.removeItem('selectedMicroDistricts');
				updateSelectedMicroDistricts();
				updateResetButton();
			});
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–í—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω"
        function updateSelectButtonState() {
            const selectButton = document.getElementById('selectButton');
            if (Object.keys(selectedPolygons).length > 0) {
                selectButton.disabled = false;
                selectButton.classList.add('active');
                selectButton.textContent = "–ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–±–æ—Ä";
            } else {
                selectButton.disabled = true;
                selectButton.classList.remove('active');
                selectButton.textContent = "–í—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω";
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –±–ª–æ–∫–∞ –≤—ã–±–æ—Ä–∞ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤
		function openMicroDistrictSelector() {
			document.getElementById('microdistrictSelector').style.display = 'block';
			// –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ–∏—Å–∫–∞
			document.getElementById('searchInput').value = '';
			
			if (map) {
				// –û—á–∏—â–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
				if (marker) {
					map.removeLayer(marker);
					marker = null;
				}
				// –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Ä—Ç—ã
				map.setView([53.2, 45.0], 11);
			} else {
				loadGeoJSONData();
			}
		}

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –±–ª–æ–∫–∞ –≤—ã–±–æ—Ä–∞ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤
        function closeMicroDistrictSelector() {
            document.getElementById('microdistrictSelector').style.display = 'none';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –æ–∫–Ω–µ
        function updateSelectedMicroDistricts() {
			const selectedMicroDistricts = JSON.parse(localStorage.getItem('selectedMicroDistricts')) || [];
			const selectedMicroDistrictsContainer = document.getElementById('selectedMicroDistricts');
			selectedMicroDistrictsContainer.innerHTML = selectedMicroDistricts
				.map(microDistrict => `
					<div class="district">
						${microDistrict}
						<span class="remove" onclick="removeMicroDistrict('${microDistrict}')">| √ó</span>
					</div>
				`)
				.join('');
		
			const districtButton = document.getElementById('districtButton');
			if (selectedMicroDistricts.length > 0) {
				districtButton.classList.add('disabled');
				districtButton.disabled = true;
			} else {
				districtButton.classList.remove('disabled');
				districtButton.disabled = false;
			}
		
			// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë"
			checkFilters();
		}

        // –£–¥–∞–ª–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–∞
        function removeMicroDistrict(microDistrict) {
			const selectedMicroDistricts = JSON.parse(localStorage.getItem('selectedMicroDistricts')) || [];
			const updatedMicroDistricts = selectedMicroDistricts.filter(district => district !== microDistrict);
			localStorage.setItem('selectedMicroDistricts', JSON.stringify(updatedMicroDistricts));
		
			if (selectedPolygons[microDistrict]) {
				selectedPolygons[microDistrict].setStyle(defaultStyle);
				delete selectedPolygons[microDistrict];
			}
		
			updateSelectedMicroDistricts();
			updateSelectButtonState();
		}
		
		// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤—ã–±–æ—Ä–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
		document.getElementById('selectButton').addEventListener('click', () => {
			saveMicroDistricts();
		});
		
		// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤
		function saveMicroDistricts() {
			const selectedMicroDistricts = Object.keys(selectedPolygons);
			localStorage.setItem('selectedMicroDistricts', JSON.stringify(selectedMicroDistricts));
		}

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç
        function sendDataToBot(data) {
            if (typeof Telegram !== 'undefined' && Telegram.WebApp && Telegram.WebApp.sendData) {
                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç:', data); // –û—Ç–ª–∞–¥–∫–∞
                Telegram.WebApp.sendData(JSON.stringify(data));
                Telegram.WebApp.close(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
            } else {
                console.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', data);
                WebApp.showAlert('–§–∏–ª—å—Ç—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –î–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç.');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞
        function saveFilter() {
			const selectedRoomCounts = Array.from(document.querySelectorAll('#roomCountButtons .active')).length;
			if (selectedRoomCounts === 0) {
				WebApp.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–∏–ø –∂–∏–ª—å—è.');
				return;
			}
		
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–Ω—ã –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
			if (!validatePriceBeforeSave()) {
				return; // –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø—Ä–æ—à–ª–∞, –ø—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
			}
		
			const minPrice = document.getElementById('minPrice').value;
			const maxPrice = document.getElementById('maxPrice').value;
		
			const selectedDistricts = Array.from(document.querySelectorAll('.district-selector .filter-buttons button.active'))
				.map(button => button.dataset.district)
				.filter(district => district !== 'all');
			const selectedMicroDistricts = JSON.parse(localStorage.getItem('selectedMicroDistricts')) || [];
		
			if ((selectedDistricts.length === 0 && selectedMicroDistricts.length === 0)) {
				WebApp.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω –∏–ª–∏ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω.');
				return;
			}
		
			// –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
			const filters = {
				roomCounts: Array.from(document.querySelectorAll('#roomCountButtons .active')).map(btn => btn.dataset.count),
				minPrice: minPrice,
				maxPrice: maxPrice,
				districts: selectedDistricts,
				microDistricts: selectedMicroDistricts
			};
		
			// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç
			sendDataToBot(filters);
		}
		
		function handleSaveButtonClick() {
			showSaveConfirmation(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
		}
		
		function validateRoomCounts() {
			const selectedRoomCounts = Array.from(document.querySelectorAll('#roomCountButtons .active')).length;
			if (selectedRoomCounts === 0) {
				WebApp.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–∏–ø –∂–∏–ª—å—è.');
				return false;
			}
			return true;
		}
		
		function validateDistricts() {
			const selectedDistricts = Array.from(document.querySelectorAll('.district-selector .filter-buttons button.active')).length > 0;
			const selectedMicroDistricts = JSON.parse(localStorage.getItem('selectedMicroDistricts')) || [];
			if (!selectedDistricts && selectedMicroDistricts.length === 0) {
				WebApp.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω –∏–ª–∏ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω.');
				return false;
			}
			return true;
		}
		
		function prepareFilters() {
			return {
				roomCounts: Array.from(document.querySelectorAll('#roomCountButtons .active')).map(btn => btn.dataset.count),
				minPrice: document.getElementById('minPrice').value,
				maxPrice: document.getElementById('maxPrice').value,
				districts: Array.from(document.querySelectorAll('.district-selector .filter-buttons button.active'))
					.map(button => button.dataset.district)
					.filter(district => district !== 'all'),
				microDistricts: JSON.parse(localStorage.getItem('selectedMicroDistricts')) || []
			};
		}
		
		const districtIds = {
			"–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π": 111,
			"–õ–µ–Ω–∏–Ω—Å–∫–∏–π": 222,
			"–ü–µ—Ä–≤–æ–º–∞–π—Å–∫–∏–π": 333,
			"–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π": 444,
			"–ó–∞—Å–µ—á–Ω–æ–µ": 555,
			"–£—Ö—Ç–∏–Ω–∫–∞": 666,
			"–ë–æ–≥–æ—Å–ª–æ–≤–∫–∞": 777,
			"–ë–µ—Å—Å–æ–Ω–æ–≤–∫–∞": 888,
			"–ß–µ–º–æ–¥–∞–Ω–æ–≤–∫–∞": 999
		};
		
		const microDistrictIds = {"3-–ü–µ–Ω–∑–∞":1,"4-–ü–µ–Ω–∑–∞":2,"–ê–≤—Ç–æ–≤–æ–∫–∑–∞–ª":3,"–ê–≤—Ç–æ–¥—Ä–æ–º":4,"–ê—Ä–±–µ–∫–æ–≤—Å–∫–∞—è –∑–∞—Å—Ç–∞–≤–∞":5,"–ê—Ö—É–Ω—ã":6,"–ë–∞—Ä–∫–æ–≤–∫–∞":7,"–ë–µ—Å—Å–æ–Ω–æ–≤–∫–∞":8,"–ë–ª. –ê—Ä–±–µ–∫–æ–≤–æ":9,"–ë–æ–≥–æ—Å–ª–æ–≤–∫–∞":10,"–ë—É–≥—Ä–æ–≤–∫–∞":11,"–í–µ—Å—ë–ª–æ–≤–∫–∞":12,"–í–µ—Ç–µ—Ä–æ–∫":13,"–í–æ—Å–∫—Ä–µ—Å–µ–Ω–æ–≤–∫–∞ —Å–µ–ª–æ":14,"–ì–∞–∑–æ–≤—ã–π":16,"–ì–ü–ó":15,"–î–∞–ª. –ê—Ä–±–µ–∫–æ–≤–æ":17,"–î—É–±—Ä–∞–≤–∞":18,"–ó–∞–≤–æ–¥—Å–∫–æ–π":19,"–ó–∞–ø–∞–¥–Ω–∞—è –ø–æ–ª—è–Ω–∞":20,"–ó–∞–ø—Ä—É–¥–Ω—ã–π":21,"–ó–∞—Ä—è":22,"–ó–∞—Ä—è-1":23,"–ó–∞—Ä—è-2":24,"–ó–∞—Å—É—Ä—å–µ":25,"–ó–æ–ª–æ—Ç–∞—Ä–µ–≤–∫–∞":26,"–ö–∞–ª–∞–Ω—á–∞":28,"–ö–ü–î":27,"–ö—Ä–∏–≤–æ–∑–µ—Ä—å–µ":29,"–õ–µ–±–µ–¥–µ–≤–∫–∞":30,"–õ–µ–Ω–∏–Ω—Å–∫–∏–π –ª–µ—Å—Ö–æ–∑":31,"–õ–µ–æ–Ω–∏–¥–æ–≤–∫–∞":32,"–õ–µ—Å–Ω–æ–π –ø–æ—Å.":33,"–õ—É–≥–æ–º–µ—Ç—Ä–∏—è":34,"–õ—É–∫–æ–º–æ—Ä—å–µ":35,"–ú–∞–ª–∞—è –í–∞–ª—è–µ–≤–∫–∞":36,"–ú–∞–Ω—å—á–∂—É—Ä–∏—è":37,"–ú–∞—è–∫":38,"–ú—è—Å–æ–ø—Ç–∏—Ü–µ–∫–æ–º–±–∏–Ω–∞—Ç":39,"–ù–∞—Ö–∞–ª–æ–≤–∫–∞":40,"–æ. –ü–µ—Å–∫–∏":68,"–û–∫—Ä—É–∂–Ω–∞—è":41,"–ü–ì–£":42,"–ü–æ–±–æ—á–∏–Ω–æ":43,"–ø–æ—Å. –ó–∏–§":69,"–ø–æ—Å. –ö–∞–º—ã—à–∏-–•–≤–æ—â–∏":70,"–ø–æ—Å. –ú–∏—á—É—Ä–∏–Ω—Å–∫–∏–π":71,"–ø–æ—Å. –ú–æ–Ω—Ç–∞–∂–Ω—ã–π":72,"–ø–æ—Å. –ù–µ—Ñ—Ç—è–Ω–∏–∫":73,"–ø–æ—Å. –ü–æ–±–µ–¥–∞":74,"–ø–æ—Å. –ü–æ–ª–µ–≤–æ–π":75,"–ø–æ—Å.–ê—Ä–±–µ–∫–æ–≤–æ":76,"–†–∞–π–∫–∏":44,"–°–≤–µ—Ç–ª–æ–ø–æ–ª—è–Ω—Å–∫–æ–µ –ª–µ—Å–Ω–∏—á–µ—Å—Ç–≤–æ":45,"–°–µ–≤–µ—Ä":46,"–°–µ–º–µ–π–Ω—ã–π":47,"–°–æ–≤—Ö–æ–∑-—Ç–µ—Ö–Ω–∏–∫—É–º":48,"–°–æ–≥–ª–∞—Å–∏–µ":49,"–°–æ—Å–Ω–æ–≤–∫–∞":50,"–°–ø—É—Ç–Ω–∏–∫":51,"–¢–∞–º–±–æ–≤—Å–∫–∞—è –∑–∞—Å—Ç–∞–≤–∞":52,"–¢–µ–ø–ª–∏—á–Ω—ã–π":53,"–¢–µ—Ä–Ω–æ–≤–∫–∞":54,"–¢–µ—Ä–Ω–æ–≤–∫–∞(5-–π –ú–∏–∫—Ä–æ—Ä–∞–π–æ–Ω)":55,"–¢–µ—Ä–Ω–æ–≤–∫–∞(–ì–∏–¥—Ä–æ—Å—Ç—Ä–æ–π)":56,"–¢–µ—Ä–Ω–æ–≤–∫–∞(–ú–µ–∂–¥—É—Ä–µ—á—å–µ)":57,"–¢–µ—Ä–Ω–æ–≤–∫–∞(–°–≤–∏–Ω—Ç—Ä–µ—Å—Ç)":58,"–£—Ö—Ç–∏–Ω–∫–∞":59,"–¶–µ–Ω—Ç—Ä":60,"–¶–µ–Ω—Ç—Ä(–ì–ª–æ–±—É—Å)":61,"–¶–µ–Ω—Ç—Ä(–ü–∞–º—è—Ç–Ω–∏–∫)":62,"–¶–µ–Ω—Ç—Ä(–¢–¶ –°—É–≤–æ—Ä–æ–≤—Å–∫–∏–π)":63,"–¶—ã–≥–∞–Ω—Å–∫–∏–π –ø–æ—Å.":64,"–ß–µ–º–æ–¥–∞–Ω–æ–≤–∫–∞":65,"–®—É–∏—Å—Ç":66,"–Æ–∂–Ω–∞—è –ø–æ–ª—è–Ω–∞":67};

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∏ –¢–û–õ–¨–ö–û –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–Ω–µ –º–µ–Ω—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
		function encodeForSend(filters) {
			return {
				...filters, // –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –ø–æ–ª—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
				districts: filters.districts.map(name => districtIds[name] || name),
				microDistricts: filters.microDistricts.map(name => microDistrictIds[name] || name)
			};
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
		function checkDataSize(data) {
			const jsonString = JSON.stringify(data);
			const sizeInBytes = new Blob([jsonString]).size;
			// –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram WebApp - 4096 –±–∞–π—Ç (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
			return sizeInBytes <= 4096;
		}
		
		// –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –≤–∞—à–µ–º –∫–æ–¥–µ)
		async function sendDataToBot(data) {
			const encodedData = encodeForSend(data); // –ü–µ—Ä–µ–∫–æ–¥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
			
			if (!checkDataSize(encodedData)) {
				WebApp.showAlert('–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤. –£–º–µ–Ω—å—à–∏—Ç–µ –≤—ã–±–æ—Ä.');
				return;
			}
		
			if (typeof Telegram !== 'undefined' && Telegram.WebApp?.sendData) {
				Telegram.WebApp.sendData(JSON.stringify(encodedData));
				Telegram.WebApp.close();
			} else {
				console.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', encodedData);
			}
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –µ—Å—Ç—å –ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
		function checkFilters() {
			const selectedRoomCounts = Array.from(document.querySelectorAll('#roomCountButtons .active')).length > 0;
			const minPrice = document.getElementById('minPrice').value.trim();
			const maxPrice = document.getElementById('maxPrice').value.trim();
			const selectedDistricts = Array.from(document.querySelectorAll('.district-selector .filter-buttons button.active')).length > 0;
			const selectedMicroDistricts = JSON.parse(localStorage.getItem('selectedMicroDistricts')) || [];
		
			const resetAllButton = document.querySelector('.reset-all-button');
			if (selectedRoomCounts || minPrice || maxPrice || selectedDistricts || selectedMicroDistricts.length > 0) {
				resetAllButton.disabled = false; // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
			} else {
				resetAllButton.disabled = true; // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
			}
		}
		
		// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
		function clearAllFilters() {
			// –û—á–∏—Å—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∂–∏–ª—å—è
			document.querySelectorAll('#roomCountButtons .active').forEach(button => {
				button.classList.remove('active');
			});
			localStorage.removeItem('selectedRoomCounts');
		
			// –û—á–∏—Å—Ç–∫–∞ —Ü–µ–Ω—ã
			document.getElementById('minPrice').value = '';
			document.getElementById('maxPrice').value = '';
			localStorage.removeItem('minPrice');
			localStorage.removeItem('maxPrice');
		
			// –û—á–∏—Å—Ç–∫–∞ —Ä–∞–π–æ–Ω–æ–≤ –∏ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤
			clearDistricts();
		
			// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë"
			checkFilters();
		}
		
		<!-- –õ–æ–≥–∏–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å" –≤ –±–ª–æ–∫–µ "–†–∞–π–æ–Ω—ã" -->
		function clearDistricts() {
			// –û—á–∏—Å—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞–π–æ–Ω–æ–≤
			document.querySelectorAll('.district-selector .filter-buttons button.active').forEach(button => {
				button.classList.remove('active');
			});
			localStorage.removeItem('selectedDistricts');
			updateSelectedDistricts();
		
			// –û—á–∏—Å—Ç–∫–∞ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–æ–≤
			localStorage.removeItem('selectedMicroDistricts');
			updateSelectedMicroDistricts();
		
			// –û—á–∏—Å—Ç–∫–∞ –∫–∞—Ä—Ç—ã
			if (geojsonLayer) {
				geojsonLayer.eachLayer(layer => layer.setStyle(defaultStyle));
			}
			selectedPolygons = {};
		
			// –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–±–æ—Ä"
			const selectButton = document.getElementById('selectButton');
			selectButton.disabled = true;
			selectButton.classList.remove('active');
			selectButton.textContent = "–í—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω";
		
			// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–°–±—Ä–æ—Å–∏—Ç—å"
			updateResetButton();
		}
		
		// –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
		document.querySelectorAll('#roomCountButtons button').forEach(button => {
			button.addEventListener('click', checkFilters);
		});
		
		document.getElementById('minPrice').addEventListener('input', checkFilters);
		document.getElementById('maxPrice').addEventListener('input', checkFilters);
		
		document.querySelectorAll('.district-selector .filter-buttons button').forEach(button => {
			button.addEventListener('click', checkFilters);
		});
		
		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
		document.addEventListener('DOMContentLoaded', checkFilters);
		
		// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
		document.querySelectorAll('.district-selector .filter-buttons button').forEach(button => {
			button.addEventListener('click', () => {
				saveDistricts();
			});
		});
		
		document.getElementById('minPrice').addEventListener('input', savePrice);
		document.getElementById('maxPrice').addEventListener('input', savePrice);
		
		document.querySelectorAll('#roomCountButtons button').forEach(button => {
			button.addEventListener('click', () => {
				saveRoomCounts();
			});
		});

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        function showExitConfirmation() {
            document.getElementById('confirmationModal').style.display = 'flex';
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞
        function confirmExit() {
            WebApp.showAlert('–§–∏–ª—å—Ç—Ä—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã. –í–æ–∑–≤—Ä–∞—Ç –≤ –±–æ—Ç...');
            document.getElementById('confirmationModal').style.display = 'none';
        }

        // –û—Ç–º–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞
        function cancelExit() {
            document.getElementById('confirmationModal').style.display = 'none';
        }
		
		<!-- –õ–æ–≥–∏–∫–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ localStorage –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–°–±—Ä–æ—Å–∏—Ç—å" -->
		function clearFilters() {
			localStorage.removeItem('selectedMicroDistricts');
			localStorage.removeItem('selectedDistricts');
			localStorage.removeItem('minPrice');
			localStorage.removeItem('maxPrice');
			localStorage.removeItem('selectedRoomCounts');
		
			// –û—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
			document.querySelectorAll('.district-selector .filter-buttons button.active').forEach(button => {
				button.classList.remove('active');
			});
			document.getElementById('minPrice').value = '';
			document.getElementById('maxPrice').value = '';
			document.querySelectorAll('#roomCountButtons button.active').forEach(button => {
				button.classList.remove('active');
			});
			updateSelectedDistricts();
			updateSelectedMicroDistricts();
			updateResetButton();
		}
		
		<!-- document.getElementById('clearMainButton').addEventListener('click', clearFilters); -->

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∞–¥—Ä–µ—Å–∞
        function searchAddress() {
			const query = document.getElementById('searchInput').value;
			if (!query) {
				WebApp.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞.');
				return;
			}
		
			// –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ø–Ω–¥–µ–∫—Å.–ì–µ–æ–∫–æ–¥–µ—Ä
			ymaps.geocode(query, { results: 1 }).then(function (res) {
				const firstResult = res.geoObjects.get(0);
				if (!firstResult) {
					WebApp.showAlert('–ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω.');
					return;
				}
		
				const coordinates = firstResult.geometry.getCoordinates(); // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã [—à–∏—Ä–æ—Ç–∞, –¥–æ–ª–≥–æ—Ç–∞]
				const address = firstResult.getAddressLine(); // –ê–¥—Ä–µ—Å
		
				// –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É Leaflet –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö
				map.setView([coordinates[0], coordinates[1]], 16);
		
				// –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –º–∞—Ä–∫–µ—Ä, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
				if (marker) {
					map.removeLayer(marker);
				}
		
				// –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç—É Leaflet
				marker = L.marker([coordinates[0], coordinates[1]]).addTo(map)
					.bindPopup(address)
					.openPopup();
			}).catch(function (error) {
				console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏:', error);
				WebApp.showAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∞–¥—Ä–µ—Å–∞.');
			});
		}
   
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function locateUser() {
			if (!navigator.geolocation) {
				WebApp.showAlert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Geolocation API.');
				return;
			}
		
			navigator.geolocation.getCurrentPosition(
				(position) => {
					const lat = position.coords.latitude;
					const lon = position.coords.longitude;
		
					// –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É Leaflet –Ω–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
					map.setView([lat, lon], 16);
		
					// –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –º–∞—Ä–∫–µ—Ä, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
					if (marker) {
						map.removeLayer(marker);
					}
		
					// –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –º–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç—É Leaflet
					marker = L.marker([lat, lon]).addTo(map)
						.bindPopup('–í—ã –∑–¥–µ—Å—å')
						.openPopup();
				},
				(error) => {
					WebApp.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.');
					console.error('–û—à–∏–±–∫–∞ Geolocation:', error);
				}
			);
		}
    </script>
</body>
</html>
